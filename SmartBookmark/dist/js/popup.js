!function(e){function t(t){for(var a,n,o=t[0],l=t[1],m=t[2],u=0,c=[];u<o.length;u++)n=o[u],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&c.push(s[n][0]),s[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(d&&d(t);c.length;)c.shift()();return i.push.apply(i,m||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],a=!0,o=1;o<r.length;o++){var l=r[o];0!==s[l]&&(a=!1)}a&&(i.splice(t--,1),e=n(n.s=r[0]))}return e}var a={},s={4:0},i=[];function n(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var o=window.webpackJsonp=window.webpackJsonp||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var m=0;m<o.length;m++)t(o[m]);var d=l;i.push([4,0]),r()}([function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class ParameterUtil{static getResolvedUrl(e,t,r){let a=e;return t&&t.items.forEach(e=>{let t=e.value;r.items.has(e.key)&&(t=r.items.get(e.key),a=this.substituteValue(a,e.key,t))}),a}static getAllParameterValues(e,t){let r={items:new Map},a=[];return e&&e.items.forEach(e=>{let s=this.getRuntimeParamValue(e.value,t).then(t=>r.items.set(e.key,t));a.push(s)}),Promise.all(a).then(e=>(console.log("done!"),r))}static getFormattedParamName(e){return"{{"+e+"}}"}static getRuntimeParamValue(paramValue,currentActiveTab){return new Promise((resolve,reject)=>{if(paramValue.indexOf(ParameterUtil.PARAM_TYPE_SEPARATOR)>0){let items=paramValue.split(ParameterUtil.PARAM_TYPE_SEPARATOR),paramValueType=items[0],computedValue=items[1];if(paramValueType==ParameterUtil.PARAM_TYPE_ACTIVE_TAB){let e=items[1];computedValue=this.getActiveTabValue(e,currentActiveTab),resolve(computedValue)}else if(paramValueType==ParameterUtil.PARAM_TYPE_JS_VALUE){let expression=items[1];try{computedValue=eval(expression)}catch(e){console.log(e)}resolve(computedValue)}else paramValueType==ParameterUtil.PARAM_TYPE_ACTIVE_TABE_JS_VALUE&&this.getActiveTabComputedValue(items[1],currentActiveTab).then(e=>{console.log("done!"),resolve(e)})}else resolve(paramValue)})}static getActiveTabComputedValue(e,t){return new Promise((r,a)=>{let s="(function evaluateExpression(){ return "+e+" ;})()";chrome.tabs.executeScript(t.id,{code:s},e=>{e&&e[0]?r(e[0]):r("")})})}static getActiveTabValue(e,t){let r="";if(t&&t.url){r=new URL(t.url)[e]}return r}static substituteValue(e,t,r){return e=e.replace(this.getFormattedParamName(t),r)}}exports.ParameterUtil=ParameterUtil,ParameterUtil.PARAM_TYPE_ACTIVE_TAB="$ActiveTab",ParameterUtil.PARAM_TYPE_JS_VALUE="$Js",ParameterUtil.PARAM_TYPE_ACTIVE_TABE_JS_VALUE="$ActiveTab$Js",ParameterUtil.PARAM_TYPE_SEPARATOR="::"},,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(0);class s{constructor(){this.parameters={items:new Map},this.bookmarks={items:new Map},this.DataModelVersion="1.0"}initializeDefaults(){this.parameters.items.set("PM_1",{id:"PM_1",key:"CurrentTabOrigin",value:a.ParameterUtil.PARAM_TYPE_ACTIVE_TAB+a.ParameterUtil.PARAM_TYPE_SEPARATOR+"origin"}),this.parameters.items.set("PM_2",{id:"PM_2",key:"CurrentTabHost",value:a.ParameterUtil.PARAM_TYPE_ACTIVE_TAB+a.ParameterUtil.PARAM_TYPE_SEPARATOR+"host"}),this.parameters.items.set("PM_3",{id:"PM_3",key:"SampleJSParam",value:a.ParameterUtil.PARAM_TYPE_JS_VALUE+a.ParameterUtil.PARAM_TYPE_SEPARATOR+"'news on ' + new Date().toString()"}),this.parameters.items.set("PM_4",{id:"PM_4",key:"DayOfWeek",value:a.ParameterUtil.PARAM_TYPE_JS_VALUE+a.ParameterUtil.PARAM_TYPE_SEPARATOR+"new Date().toString().split(' ')[0] + 'day'"}),this.parameters.items.set("PM_5",{id:"PM_5",key:"ActiveTabPageTitle",value:a.ParameterUtil.PARAM_TYPE_ACTIVE_TABE_JS_VALUE+a.ParameterUtil.PARAM_TYPE_SEPARATOR+"document.querySelector('title') ? document.querySelector('title').innerText : 'no title';"}),this.parameters.items.set("PM_6",{id:"PM_6",key:"TenantId",value:a.ParameterUtil.PARAM_TYPE_ACTIVE_TABE_JS_VALUE+a.ParameterUtil.PARAM_TYPE_SEPARATOR+'document.querySelector("body > table > tbody > tr:nth-child(3) > td:nth-child(2)").textContent.trim()'}),this.parameters.items.set("PM_7",{id:"PM_7",key:"OrgId",value:a.ParameterUtil.PARAM_TYPE_ACTIVE_TABE_JS_VALUE+a.ParameterUtil.PARAM_TYPE_SEPARATOR+'document.querySelector("body > table > tbody > tr:nth-child(2) > td:nth-child(2)").textContent.trim()'}),this.bookmarks.items.set("BM_1",{id:"BM_1",name:"TenantInfo",url:"{{CurrentTabOrigin}}/qa/cdp/cdp.jsp"}),this.bookmarks.items.set("BM_2",{id:"BM_2",name:"Generate JWT",url:"{{CurrentTabOrigin}}/qa/cdp/generatejwt.jsp"}),this.bookmarks.items.set("BM_3",{id:"BM_3",name:"Mint JWT",url:"{{CurrentTabOrigin}}/qa/cdp/mintedjwt.jsp?issuerId={{OrgId}}&audienceId={{TenantId}}&type=JWT"}),this.bookmarks.items.set("BM_4",{id:"BM_4",name:"News Today",url:"https://www.google.com/search?q={{SampleJSParam}}"}),this.bookmarks.items.set("BM_5",{id:"BM_5",name:"Google Current Host",url:"https://www.google.com/search?q={{CurrentTabHost}}"}),this.bookmarks.items.set("BM_6",{id:"BM_6",name:"Joke on Day",url:"https://www.google.com/search?q=Tell me a joke about {{DayOfWeek}}"}),this.bookmarks.items.set("BM_7",{id:"BM_7",name:"Google Current Page Title",url:"https://www.google.com/search?q={{ActiveTabPageTitle}}"})}initialize(){this.initializeDefaults();let e=this.saveParameters(this.parameters),t=this.saveBookmarks(this.bookmarks);return Promise.all([e,t]).then()}getBookmarks(){return new Promise((e,t)=>{chrome.storage.sync.get("BookmarkList",t=>{let r=s.deserializeBookmarks(t.BookmarkList);e(r)})})}getBookmark(e){return this.getBookmarks().then(t=>t.items.has(e)?t.items.get(e):null)}getParameters(){return new Promise((e,t)=>{chrome.storage.sync.get("ParamList",t=>{let r=s.deserializeParameters(t.ParamList);e(r)})})}getParameter(e){return this.getParameters().then(t=>t.items.has(e)?t.items.get(e):null)}saveParameters(e){return new Promise((t,r)=>{let a=s.serializeParameters(e);chrome.storage.sync.set({ParamList:a},()=>{console.log("Saved parameters"),t()})})}saveBookmarks(e){return new Promise((t,r)=>{let a=s.serializeBookmarks(e);chrome.storage.sync.set({BookmarkList:a},()=>{console.log("Saved bookmarks"),t()})})}addBookmarks(e){return e&&e.length>0?this.getBookmarks().then(t=>(e.forEach(e=>{t.items.set(e.id,e)}),this.saveBookmarks(t))):null}addBookmark(e){return this.getBookmarks().then(t=>(t.items.set(e.id,e),this.saveBookmarks(t)))}deleteBookmark(e){return this.getBookmarks().then(t=>(t.items.delete(e),this.saveBookmarks(t)))}addParameters(e){return e&&e.length>0?this.getParameters().then(t=>(e.forEach(e=>{t.items.set(e.id,e)}),this.saveParameters(t))):null}addParameter(e){return this.getParameters().then(t=>(t.items.set(e.id,e),this.saveParameters(t)))}deleteParameter(e){return this.getParameters().then(t=>(t.items.delete(e),this.saveParameters(t)))}static serializeBookmarks(e){let t="";return e&&(t=JSON.stringify([...e.items])),t}static serializeParameters(e){let t="";return e&&(t=JSON.stringify([...e.items])),t}static deserializeBookmarks(e){return{items:JSON.parse(e).reduce((e,[t,r])=>e.set(t,r),new Map)}}static deserializeParameters(e){return{items:JSON.parse(e).reduce((e,[t,r])=>e.set(t,r),new Map)}}}t.Store=s,s.instance=new s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Util=class{static getUniqueId(e){return e+"_"+Math.floor(Math.random()*Date.now()).toString()}static isString(e){return"string"==typeof e||e instanceof String}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(1),s=r(5);a((function(){a(document).ready(()=>{s.PopupController.instance.render()});var e,t=document.getElementsByClassName("collapsible");for(e=0;e<t.length;e++)t[e].addEventListener("click",(function(){this.classList.toggle("active");var e=this.nextElementSibling;e.style.maxHeight?e.style.maxHeight=null:e.style.maxHeight=e.scrollHeight+"px"}))}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(2),s=r(6),i=r(7),n=r(8),o=r(0),l=r(3),m=r(1);class d{constructor(){this.bookmarkEditId=null,this.parameterEditId=null}render(){console.log("rendering!");let e=this.renderBookmarks();return this.renderBookmarkAddControls(),this.renderParameters(),this.renderParameterAddControls(),this.renderImportControls(),e.then(()=>{console.log("rendering complete!")})}getCurrentActiveTab(){let e={active:!0,currentWindow:!0};return new Promise((t,r)=>{chrome.tabs.query(e,e=>{let r=e[0];t(r)})})}renderBookmarks(){let e=a.Store.instance.getBookmarks(),t=this.getCurrentActiveTab(),r=a.Store.instance.getParameters();return Promise.all([e,r,t]).then(e=>{let t=e[0],r=e[1],a=e[2];this.renderExportLink(t,r);let s=document.getElementById("bookmarkList");if(s){let e=document.createElement("ul");return e.className="bmUList",o.ParameterUtil.getAllParameterValues(r,a).then(a=>{t.items.forEach(t=>{let s=t.url,i=o.ParameterUtil.getResolvedUrl(s,r,a),l=n.HtmlUtil.getBookmarkDisplay(t,i,this.deleteBookmark.bind(this),this.editBookmark.bind(this));e.appendChild(l)}),s.innerHTML="",s.appendChild(e)})}})}renderBookmarkAddControls(){m("#bmName").val(""),m("#bmUrl").val(""),this.bookmarkEditId=null,m("#bmAdd").off("click").on("click",()=>{let e=m("#bmName").val(),t=m("#bmUrl").val();this.addBookmarkItem(this.bookmarkEditId,e,t).then(()=>{this.render()})})}addBookmarkItem(e,t,r){if(t&&r){null!=e&&""!=e||(e=l.Util.getUniqueId(s.BOOKMARK_ID_PREFIX));let i={id:e,name:t,url:r};return a.Store.instance.addBookmark(i)}}deleteBookmark(e){a.Store.instance.deleteBookmark(e).then(()=>{this.render()})}editBookmark(e){a.Store.instance.getBookmark(e).then(t=>{t&&(this.bookmarkEditId=e,m("#bmName").val(t.name),m("#bmUrl").val(t.url))})}renderParameters(){let e=a.Store.instance.getParameters(),t=document.getElementById("globalParameterList");t&&e.then(e=>{document.createElement("table");let r=[],a=[];e.items.forEach(e=>{if(e){let t=n.HtmlUtil.getCloseButton(e.id,this.deleteParameter.bind(this)),s=[e.key,e.value,t];a.push(e.id),r.push(s)}});let s=[];s.push("Key"),s.push("Value"),s.push("x");let i=n.HtmlUtil.createTable(r,s,a,this.editParameter.bind(this));t.innerHTML="",t.appendChild(i)})}renderParameterAddControls(){m("#pmKey").val(""),m("#pmValue").val(""),this.parameterEditId=null,m("#pmAdd").off("click").on("click",()=>{let e=m("#pmKey").val(),t=m("#pmValue").val();this.addParameter(this.parameterEditId,e,t).then(()=>{this.render()})})}addParameter(e,t,r){if(t&&r){null!=e&&""!=e||(e=l.Util.getUniqueId(i.PARAMETER_ID_PREFIX));let s={id:e,key:t,value:r};return a.Store.instance.addParameter(s)}}deleteParameter(e){a.Store.instance.deleteParameter(e).then(()=>{this.render()})}editParameter(e){a.Store.instance.getParameter(e).then(e=>{e&&(this.parameterEditId=e.id,m("#pmKey").val(e.key),m("#pmValue").val(e.value))})}renderExportLink(e,t){let r=document.getElementById("downloadlink");if(r){let s={version:a.Store.instance.DataModelVersion,bookmarks:[],parameters:[]};e.items.forEach(e=>{s.bookmarks.push(e)}),t.items.forEach(e=>{s.parameters.push(e)});let i=JSON.stringify(s),n="text/json;charset=utf-8,"+encodeURIComponent(i);r.setAttribute("href","data:"+n),r.setAttribute("download","SmartBookmarks.json")}}renderImportControls(){document.getElementById("importFile").onchange=this.onImport.bind(this)}onImport(e){try{let t=e.target.files;if(!t.length)return void alert("No file selected!");let r=t[0],a=new FileReader;a.onload=e=>{console.log("FILE CONTENT",e.target.result);let t=e.target.result,r=JSON.parse(t);this.importData(r)},a.readAsText(r)}catch(e){console.error(e)}}importData(e){if(e){let t=[];e.bookmarks&&t.push(a.Store.instance.addBookmarks(e.bookmarks)),e.parameters&&t.push(a.Store.instance.addParameters(e.parameters)),Promise.all(t).then(()=>{this.render()})}}}t.PopupController=d,d.instance=new d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.BOOKMARK_ID_PREFIX="BM"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PARAMETER_ID_PREFIX="PM"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(3);class s{static createTable(e,t,r,s){let i=document.createElement("table");if(t){let e=document.createElement("thead"),r=document.createElement("tr");t.forEach((function(e){let t=document.createElement("th");t.appendChild(document.createTextNode(e)),r.appendChild(t)})),e.appendChild(r),i.appendChild(e)}let n=document.createElement("tbody"),o=0;return e.forEach((function(e){let t=document.createElement("tr"),i=r[o++];e.forEach((function(e){let r=document.createElement("td"),s=e;a.Util.isString(e)?r.appendChild(document.createTextNode(e)):r.appendChild(s),t.appendChild(r)})),t.ondblclick=()=>{s(i)},n.appendChild(t)})),i.appendChild(n),i}static getListItemWithClose(e,t,r,a){let i=document.createElement("li");i.className="bmUListItem",i.appendChild(e);let n=s.getCloseButton(t,r);return i.appendChild(n),i.ondblclick=()=>{a(t)},i}static getCloseButton(e,t){let r=document.createElement("span");return e.startsWith("BM")?r.className="closeBookmark":r.className="closeParam",r.innerHTML="&times;",r.addEventListener("click",()=>{t(e)}),r}static getBookmarkDisplay(e,t,r,a){let i=s.getAnchorElement(e.name,t);return s.getListItemWithClose(i,e.id,r,a)}static getAnchorElement(e,t){let r=document.createElement("A"),a=document.createTextNode(e);return r.setAttribute("target","_base"),r.setAttribute("href",t),r.appendChild(a),r}}t.HtmlUtil=s}]);